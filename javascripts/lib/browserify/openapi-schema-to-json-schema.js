(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.OpenapiSchemaToJsonSchema=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){var deepEqual=require("fast-deep-equal");var convert=require("./lib/convert");module.exports=openapiSchemaToJsonSchema;module.exports.fromSchema=openapiSchemaToJsonSchema;module.exports.fromParameter=openapiParameterToJsonSchema;function openapiSchemaToJsonSchema(schema,options){options=resolveOptions(options);var jsonSchema=convert.fromSchema(schema,options);return jsonSchema}function openapiParameterToJsonSchema(parameter,options){options=resolveOptions(options);var jsonSchema=convert.fromParameter(parameter,options);return jsonSchema}function resolveOptions(options){var notSupported=["nullable","discriminator","readOnly","writeOnly","xml","externalDocs","example","deprecated"];options=options||{};options.dateToDateTime=options.dateToDateTime||false;options.cloneSchema=options.cloneSchema==false?false:true;options.supportPatternProperties=options.supportPatternProperties||false;options.keepNotSupported=options.keepNotSupported||[];options.strictMode=options.strictMode==false?false:true;if(typeof options.patternPropertiesHandler!=="function"){options.patternPropertiesHandler=patternPropertiesHandler}options._removeProps=[];if(options.removeReadOnly===true){options._removeProps.push("readOnly")}if(options.removeWriteOnly===true){options._removeProps.push("writeOnly")}options._structs=["allOf","anyOf","oneOf","not","items","additionalProperties"];options._notSupported=resolveNotSupported(notSupported,options.keepNotSupported);return options}function patternPropertiesHandler(schema){var pattern;var patternsObj=schema.patternProperties;var additProps=schema.additionalProperties;if(typeof additProps!=="object"){return schema}for(pattern in patternsObj){if(deepEqual(patternsObj[pattern],additProps)){schema.additionalProperties=false;break}}return schema}function resolveNotSupported(notSupported,toRetain){var i=0;var index;for(i;i<toRetain.length;i++){index=notSupported.indexOf(toRetain[i]);if(index>=0){notSupported.splice(index,1)}}return notSupported}},{"./lib/convert":2,"fast-deep-equal":8}],2:[function(require,module,exports){var convertFromSchema=require("./converters/schema");var convertFromParameter=require("./converters/parameter");module.exports={fromSchema:convertFromSchema,fromParameter:convertFromParameter}},{"./converters/parameter":3,"./converters/schema":4}],3:[function(require,module,exports){var convertFromSchema=require("./schema");var InvalidInputError=require("../errors/invalid-input-error");module.exports=convertFromParameter;function convertFromParameter(parameter,options){if(parameter.schema!==undefined){return convertParameterSchema(parameter,parameter.schema,options)}else if(parameter.content!==undefined){return convertFromContents(parameter,options)}else{if(options.strictMode){throw new InvalidInputError("OpenAPI parameter must have either a 'schema' or a 'content' property")}return convertParameterSchema(parameter,{},options)}}function convertFromContents(parameter,options){var schemas={};for(var mime in parameter.content){schemas[mime]=convertParameterSchema(parameter,parameter.content[mime].schema,options)}return schemas}function convertParameterSchema(parameter,schema,options){var jsonSchema=convertFromSchema(schema||{},options);if(parameter.description){jsonSchema.description=parameter.description}return jsonSchema}},{"../errors/invalid-input-error":5,"./schema":4}],4:[function(require,module,exports){var isObject=require("../utils/isObject").isObject;var InvalidTypeError=require("../errors/invalid-type-error");module.exports=convertFromSchema;function convertFromSchema(schema,options){schema=convertSchema(schema,options);schema.$schema="http://json-schema.org/draft-04/schema#";return schema}function convertSchema(schema,options){if(options.cloneSchema){schema=Object.assign({},schema)}var structs=options._structs;var notSupported=options._notSupported;var strictMode=options.strictMode;var i=0;var j=0;var struct=null;for(i;i<structs.length;i++){struct=structs[i];if(Array.isArray(schema[struct])){var cloned=false;for(j;j<schema[struct].length;j++){if(!isObject(schema[struct][j])){if(options.cloneSchema&&!cloned){cloned=true;schema[struct]=schema[struct].slice()}schema[struct].splice(j,1);j--;continue}schema[struct][j]=convertSchema(schema[struct][j],options)}}else if(schema[struct]===null){delete schema[struct]}else if(typeof schema[struct]==="object"){schema[struct]=convertSchema(schema[struct],options)}}if("properties"in schema){schema.properties=convertProperties(schema.properties,options);if(Array.isArray(schema.required)){schema.required=cleanRequired(schema.required,schema.properties);if(schema.required.length===0){delete schema.required}}if(Object.keys(schema.properties).length===0){delete schema.properties}}if(strictMode){validateType(schema.type)}schema=convertTypes(schema);schema=convertFormat(schema,options);if("x-patternProperties"in schema&&options.supportPatternProperties){schema=convertPatternProperties(schema,options.patternPropertiesHandler)}for(i=0;i<notSupported.length;i++){delete schema[notSupported[i]]}return schema}function validateType(type){var validTypes=["integer","number","string","boolean","object","array","null"];if(validTypes.indexOf(type)<0&&type!==undefined){throw new InvalidTypeError("Type "+JSON.stringify(type)+" is not a valid type")}}function convertProperties(properties,options){var key;var property;var props={};var removeProp;if(!isObject(properties)){return props}for(key in properties){property=properties[key];if(!isObject(property)){continue}removeProp=options._removeProps.some(function(prop){return property[prop]===true});if(removeProp){continue}props[key]=convertSchema(property,options)}return props}function convertTypes(schema){if(schema.type!==undefined&&schema.nullable===true){schema.type=[schema.type,"null"];if(Array.isArray(schema.enum)&&!schema.enum.includes(null)){schema.enum=schema.enum.concat([null])}}return schema}function convertFormat(schema,options){var format=schema.format;var settings={MIN_INT_32:0-Math.pow(2,31),MAX_INT_32:Math.pow(2,31)-1,MIN_INT_64:0-Math.pow(2,63),MAX_INT_64:Math.pow(2,63)-1,MIN_FLOAT:0-Math.pow(2,128),MAX_FLOAT:Math.pow(2,128)-1,MIN_DOUBLE:0-Number.MAX_VALUE,MAX_DOUBLE:Number.MAX_VALUE,BYTE_PATTERN:"^[\\w\\d+\\/=]*$"};var FORMATS=["date-time","email","hostname","ipv4","ipv6","uri","uri-reference"];if(format===undefined||FORMATS.indexOf(format)!==-1){return schema}if(format==="date"&&options.dateToDateTime===true){return convertFormatDate(schema)}var formatConverters={int32:convertFormatInt32,int64:convertFormatInt64,float:convertFormatFloat,double:convertFormatDouble,byte:convertFormatByte};var converter=formatConverters[format];if(converter===undefined){return schema}return converter(schema,settings)}function convertFormatInt32(schema,settings){if(!schema.minimum&&schema.minimum!==0||schema.minimum<settings.MIN_INT_32){schema.minimum=settings.MIN_INT_32}if(!schema.maximum&&schema.maximum!==0||schema.maximum>settings.MAX_INT_32){schema.maximum=settings.MAX_INT_32}return schema}function convertFormatInt64(schema,settings){if(!schema.minimum&&schema.minimum!==0||schema.minimum<settings.MIN_INT_64){schema.minimum=settings.MIN_INT_64}if(!schema.maximum&&schema.maximum!==0||schema.maximum>settings.MAX_INT_64){schema.maximum=settings.MAX_INT_64}return schema}function convertFormatFloat(schema,settings){if(!schema.minimum&&schema.minimum!==0||schema.minimum<settings.MIN_FLOAT){schema.minimum=settings.MIN_FLOAT}if(!schema.maximum&&schema.maximum!==0||schema.maximum>settings.MAX_FLOAT){schema.maximum=settings.MAX_FLOAT}return schema}function convertFormatDouble(schema,settings){if(!schema.minimum&&schema.minimum!==0||schema.minimum<settings.MIN_DOUBLE){schema.minimum=settings.MIN_DOUBLE}if(!schema.maximum&&schema.maximum!==0||schema.maximum>settings.MAX_DOUBLE){schema.maximum=settings.MAX_DOUBLE}return schema}function convertFormatDate(schema){schema.format="date-time";return schema}function convertFormatByte(schema,settings){schema.pattern=settings.BYTE_PATTERN;return schema}function convertPatternProperties(schema,handler){if(isObject(schema["x-patternProperties"])){schema.patternProperties=schema["x-patternProperties"]}delete schema["x-patternProperties"];return handler(schema)}function cleanRequired(required,properties){required=required||[];properties=properties||{};let remainedRequired=[];for(let i=0;i<required.length;i++){if(properties[required[i]]){remainedRequired.push(required[i])}}return remainedRequired}},{"../errors/invalid-type-error":6,"../utils/isObject":7}],5:[function(require,module,exports){module.exports=InvalidInputError;function InvalidInputError(message){this.name="InvalidInputError";this.message=message}InvalidInputError.prototype=new Error},{}],6:[function(require,module,exports){module.exports=InvalidTypeError;function InvalidTypeError(message){this.name="InvalidTypeError";this.message=message}InvalidTypeError.prototype=Error.prototype},{}],7:[function(require,module,exports){exports.isObject=function(maybeObj){return maybeObj!==null&&typeof maybeObj==="object"}},{}],8:[function(require,module,exports){"use strict";module.exports=function equal(a,b){if(a===b)return true;if(a&&b&&typeof a=="object"&&typeof b=="object"){if(a.constructor!==b.constructor)return false;var length,i,keys;if(Array.isArray(a)){length=a.length;if(length!=b.length)return false;for(i=length;i--!==0;)if(!equal(a[i],b[i]))return false;return true}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();keys=Object.keys(a);length=keys.length;if(length!==Object.keys(b).length)return false;for(i=length;i--!==0;)if(!Object.prototype.hasOwnProperty.call(b,keys[i]))return false;for(i=length;i--!==0;){var key=keys[i];if(!equal(a[key],b[key]))return false}return true}return a!==a&&b!==b}},{}]},{},[1])(1)});
